# 对话标题生成功能

## 功能概述

本功能为每个对话会话自动生成简洁的中文标题，提升历史记录的可读性和搜索体验。

## 主要特性

### 1. 自动标题生成
- 使用LLM为对话会话生成10-20字的简洁中文标题
- 基于对话的前几轮交互内容生成标题
- 异步生成，不影响正常对话流程

### 2. 智能触发机制
- 仅对包含用户问题和AI回答的完整对话生成标题
- 跳过纯系统消息或单一消息的会话
- 避免重复生成，保持标题稳定性

### 3. 配置选项
- `enableTitleGeneration`: 是否启用标题生成（默认：true）
- `titleGenerationModel`: 专用标题生成模型（默认：使用当前模型）

### 4. 向后兼容
- 支持没有标题的旧会话数据
- 提供默认标题格式作为降级方案

## 使用方法

### 配置设置

在配置文件中可以控制标题生成功能：

```json
{
  "enableTitleGeneration": true,
  "titleGenerationModel": "gpt-3.5-turbo"
}
```

### 历史记录查看

使用 `llmhistory search` 命令查看带标题的历史记录：

```
/llmhistory search <玩家> <关键词>
```

输出示例：
```
=== 搜索结果 ===
玩家: PlayerName
关键词: Java
找到 2 个会话

会话 1:
  标题: Java多态性概念解释
  时间: 2024-01-15 14:30:25
  模板: default
  消息数: 6

会话 2:
  标题: Java集合框架使用指南
  时间: 2024-01-15 15:45:12
  模板: default
  消息数: 8
```

## 技术实现

### 核心组件

1. **TitleGenerationService**: 标题生成服务
   - 管理标题生成逻辑
   - 处理异步调用和错误处理
   - 验证生成的标题质量

2. **ChatSession**: 扩展的会话数据结构
   - 添加 `title` 字段存储标题
   - 提供 `getDisplayTitle()` 方法获取显示标题
   - 支持向后兼容的默认标题格式

3. **配置集成**: 
   - 在 `LLMChatConfig` 中添加相关配置项
   - 支持运行时配置修改

### 标题生成流程

1. 用户与AI完成对话交互
2. 系统保存会话到历史记录
3. 检查是否需要生成标题（新会话且包含完整对话）
4. 异步调用LLM生成标题
5. 更新会话记录并保存到文件

### 错误处理

- 标题生成失败时不影响正常功能
- 提供默认标题格式作为降级方案
- 记录生成过程中的错误信息

## 性能考虑

- 异步生成避免阻塞主线程
- 可配置使用更便宜的模型进行标题生成
- 设置合理的超时时间（10秒）
- 限制标题长度和生成频率

## 测试覆盖

- 单元测试覆盖核心逻辑
- 测试各种边界情况
- 验证向后兼容性
- 测试配置选项的正确性

## 未来扩展

- 支持多语言标题生成
- 添加标题编辑功能
- 实现标题搜索优化
- 支持标题模板自定义
