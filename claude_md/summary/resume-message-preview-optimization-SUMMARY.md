# Resumeå‘½ä»¤æ¶ˆæ¯é¢„è§ˆä¼˜åŒ– - SUMMARY

## ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–ä¸»è¦é’ˆå¯¹resumeå‘½ä»¤çš„æ¶ˆæ¯é¢„è§ˆåŠŸèƒ½è¿›è¡Œäº†å…¨é¢æ”¹è¿›ï¼Œæå‡äº†ç”¨æˆ·åœ¨æ¢å¤å†å²å¯¹è¯æ—¶çš„ä½“éªŒã€‚

## ä¸»è¦æ”¹è¿›

### 1. ç»Ÿä¸€çš„æ¶ˆæ¯é¢„è§ˆä½“éªŒ

**é—®é¢˜**ï¼š
- `handleResume()`æ–¹æ³•æœ‰æ¶ˆæ¯é¢„è§ˆåŠŸèƒ½
- `handleResumeById()`æ–¹æ³•æ²¡æœ‰æ¶ˆæ¯é¢„è§ˆåŠŸèƒ½
- ä¸¤ä¸ªæ–¹æ³•çš„ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åˆ›å»ºäº†é€šç”¨çš„`showMessagePreview()`æ–¹æ³•
- ä¸¤ä¸ªresumeæ–¹æ³•éƒ½ä½¿ç”¨ç›¸åŒçš„é¢„è§ˆé€»è¾‘
- ç¡®ä¿ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ

### 2. æ”¹è¿›çš„æ¶ˆæ¯æ˜¾ç¤ºæ ¼å¼

**ä¹‹å‰çš„æ ¼å¼**ï¼š
```
æœ€è¿‘çš„å¯¹è¯å†…å®¹:
  ä½ : è¯·å¸®æˆ‘è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ 
  AI: æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå®ƒè®©è®¡ç®—æœºèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ ...
```

**ä¼˜åŒ–åçš„æ ¼å¼**ï¼š
```
ğŸ“‹ æœ€è¿‘çš„å¯¹è¯å†…å®¹ (ä¸Šæ¬¡å¯¹è¯) (æ˜¾ç¤ºæœ€å5æ¡):
  [1] ğŸ™‹ ä½ : è¯·å¸®æˆ‘è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ 
  [2] ğŸ¤– AI: æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå®ƒè®©è®¡ç®—æœºèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ ...
  [3] ğŸ™‹ ä½ : èƒ½ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­å—ï¼Ÿ
  [4] ğŸ¤– AI: å½“ç„¶å¯ä»¥ï¼æ¯”å¦‚é‚®ä»¶åƒåœ¾è¿‡æ»¤å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„æœºå™¨å­¦ä¹ åº”ç”¨...
  [5] âš™ï¸ ç³»ç»Ÿ: ä¼šè¯å·²è‡ªåŠ¨ä¿å­˜
```

**æ”¹è¿›ç‚¹**ï¼š
- æ·»åŠ äº†emojiå›¾æ ‡åŒºåˆ†ä¸åŒè§’è‰²ï¼ˆğŸ™‹ç”¨æˆ·ã€ğŸ¤–AIã€âš™ï¸ç³»ç»Ÿï¼‰
- æ·»åŠ äº†æ¶ˆæ¯åºå· [1], [2], [3]...
- ä½¿ç”¨ä¸åŒé¢œè‰²åŒºåˆ†è§’è‰²ï¼ˆç»¿è‰²ç”¨æˆ·ã€è“è‰²AIã€é»„è‰²ç³»ç»Ÿï¼‰
- æ˜¾ç¤ºä¼šè¯ä¿¡æ¯å’Œæ¶ˆæ¯æ•°é‡
- æ·»åŠ äº†åˆ†éš”çº¿æ”¹å–„è§†è§‰æ•ˆæœ

### 3. æ™ºèƒ½æ¶ˆæ¯æˆªæ–­

**æ”¹è¿›çš„æˆªæ–­é€»è¾‘**ï¼š
- é»˜è®¤æœ€å¤§é•¿åº¦ä»100å­—ç¬¦å¢åŠ åˆ°150å­—ç¬¦
- æ™ºèƒ½æˆªæ–­ï¼šä¼˜å…ˆåœ¨å¥å·ã€é—®å·ã€æ„Ÿå¹å·åæˆªæ–­
- é¿å…åœ¨å•è¯æˆ–å¥å­ä¸­é—´æˆªæ–­
- æ›´å¥½åœ°ä¿æŒæ¶ˆæ¯çš„å®Œæ•´æ€§å’Œå¯è¯»æ€§

**æˆªæ–­ç®—æ³•**ï¼š
```java
// æ™ºèƒ½æˆªæ–­ï¼šå°½é‡åœ¨å¥å·ã€é—®å·ã€æ„Ÿå¹å·åæˆªæ–­
int cutPoint = maxContentLength;
for (int j = Math.min(maxContentLength - 10, content.length() - 1); 
     j >= maxContentLength - 30 && j > 0; j--) {
    char c = content.charAt(j);
    if (c == 'ã€‚' || c == 'ï¼Ÿ' || c == 'ï¼' || c == '.' || c == '?' || c == '!') {
        cutPoint = j + 1;
        break;
    }
}
```

### 4. å¯é…ç½®çš„é¢„è§ˆå‚æ•°

**æ–°å¢é…ç½®é¡¹**ï¼š
- `messagePreviewCount`: é¢„è§ˆæ¶ˆæ¯æ•°é‡ï¼ˆé»˜è®¤5æ¡ï¼ŒèŒƒå›´1-10ï¼‰
- `messagePreviewMaxLength`: æ¶ˆæ¯æœ€å¤§æ˜¾ç¤ºé•¿åº¦ï¼ˆé»˜è®¤150å­—ç¬¦ï¼ŒèŒƒå›´50-500ï¼‰

**é…ç½®ä½ç½®**ï¼š
- `ConfigDefaults.java`: å®šä¹‰é»˜è®¤å€¼
- `LLMChatConfig.java`: é…ç½®ç®¡ç†å’Œgetter/setteræ–¹æ³•
- æ”¯æŒè¿è¡Œæ—¶é…ç½®ä¿®æ”¹å’Œä¿å­˜

### 5. å¢å¼ºçš„è§’è‰²è¯†åˆ«

**æ”¯æŒçš„æ¶ˆæ¯è§’è‰²**ï¼š
- `USER` (ç”¨æˆ·): ğŸ™‹ ä½  (ç»¿è‰²)
- `ASSISTANT` (AIåŠ©æ‰‹): ğŸ¤– AI (è“è‰²)  
- `SYSTEM` (ç³»ç»Ÿ): âš™ï¸ ç³»ç»Ÿ (é»„è‰²)
- `æœªçŸ¥è§’è‰²`: â“ æœªçŸ¥ (ç°è‰²)

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒæ–¹æ³•ï¼šshowMessagePreview()

```java
private static void showMessagePreview(PlayerEntity player, List<LLMMessage> messages, String sessionInfo) {
    // ä»é…ç½®è·å–å‚æ•°
    LLMChatConfig config = LLMChatConfig.getInstance();
    int maxPreviewCount = config.getMessagePreviewCount();
    int maxContentLength = config.getMessagePreviewMaxLength();
    
    // è®¡ç®—é¢„è§ˆæ•°é‡
    int previewCount = Math.min(maxPreviewCount, messages.size());
    
    // æ˜¾ç¤ºæ ‡é¢˜å’Œæ¶ˆæ¯
    // ... æ ¼å¼åŒ–å’Œæ˜¾ç¤ºé€»è¾‘
}
```

### é…ç½®é›†æˆ

**ConfigDefaults.java**:
```java
public static final int DEFAULT_MESSAGE_PREVIEW_COUNT = 5;
public static final int DEFAULT_MESSAGE_PREVIEW_MAX_LENGTH = 150;
```

**LLMChatConfig.java**:
```java
private int messagePreviewCount = ConfigDefaults.DEFAULT_MESSAGE_PREVIEW_COUNT;
private int messagePreviewMaxLength = ConfigDefaults.DEFAULT_MESSAGE_PREVIEW_MAX_LENGTH;

public int getMessagePreviewCount() { return messagePreviewCount; }
public void setMessagePreviewCount(int count) { 
    this.messagePreviewCount = Math.max(1, Math.min(10, count)); 
}
```

## ç”¨æˆ·ä½“éªŒæ”¹è¿›

### Resumeå‘½ä»¤ (`/llmchat resume`)
**ä¹‹å‰**ï¼š
```
å·²æ¢å¤ä¸Šæ¬¡å¯¹è¯ï¼Œå…± 8 æ¡æ¶ˆæ¯
æœ€è¿‘çš„å¯¹è¯å†…å®¹:
  ä½ : æµ‹è¯•æ¶ˆæ¯...
  AI: AIå›å¤...
```

**ç°åœ¨**ï¼š
```
âœ… å·²æ¢å¤ä¸Šæ¬¡å¯¹è¯ï¼Œå…± 8 æ¡æ¶ˆæ¯
ğŸ“‹ æœ€è¿‘çš„å¯¹è¯å†…å®¹ (ä¸Šæ¬¡å¯¹è¯) (æ˜¾ç¤ºæœ€å5æ¡):
  [1] ğŸ™‹ ä½ : æµ‹è¯•æ¶ˆæ¯1
  [2] ğŸ¤– AI: AIå›å¤1
  [3] ğŸ™‹ ä½ : æµ‹è¯•æ¶ˆæ¯2
  [4] ğŸ¤– AI: AIå›å¤2
  [5] ğŸ™‹ ä½ : æµ‹è¯•æ¶ˆæ¯3

```

### Resume By IDå‘½ä»¤ (`/llmchat resume <id>`)
**ä¹‹å‰**ï¼š
```
å·²æ¢å¤å¯¹è¯ #2: æµ‹è¯•ä¼šè¯ï¼Œå…± 6 æ¡æ¶ˆæ¯
```

**ç°åœ¨**ï¼š
```
âœ… å·²æ¢å¤å¯¹è¯ #2: æµ‹è¯•ä¼šè¯ï¼Œå…± 6 æ¡æ¶ˆæ¯
ğŸ“‹ æœ€è¿‘çš„å¯¹è¯å†…å®¹ (å¯¹è¯ #2) (æ˜¾ç¤ºæœ€å5æ¡):
  [1] ğŸ™‹ ä½ : å†å²æ¶ˆæ¯1
  [2] ğŸ¤– AI: å†å²å›å¤1
  [3] ğŸ™‹ ä½ : å†å²æ¶ˆæ¯2
  [4] ğŸ¤– AI: å†å²å›å¤2
  [5] ğŸ™‹ ä½ : å†å²æ¶ˆæ¯3

```

## æµ‹è¯•éªŒè¯

åˆ›å»ºäº†å…¨é¢çš„æµ‹è¯•å¥—ä»¶ `MessagePreviewTest.java`ï¼š

1. **æ¶ˆæ¯æˆªæ–­æµ‹è¯•**: éªŒè¯é•¿æ¶ˆæ¯çš„æ­£ç¡®æˆªæ–­
2. **æ™ºèƒ½æˆªæ–­æµ‹è¯•**: éªŒè¯åœ¨åˆé€‚ä½ç½®æˆªæ–­çš„é€»è¾‘
3. **è§’è‰²å¤„ç†æµ‹è¯•**: éªŒè¯ä¸åŒæ¶ˆæ¯è§’è‰²çš„æ­£ç¡®å¤„ç†
4. **é¢„è§ˆæ•°é‡æµ‹è¯•**: éªŒè¯é¢„è§ˆæ¶ˆæ¯æ•°é‡çš„é€»è¾‘
5. **ç©ºæ¶ˆæ¯å¤„ç†æµ‹è¯•**: éªŒè¯è¾¹ç•Œæƒ…å†µçš„å¤„ç†
6. **æ¶ˆæ¯ç´¢å¼•æµ‹è¯•**: éªŒè¯æ¶ˆæ¯åºå·çš„æ­£ç¡®æ€§
7. **å¯é…ç½®å‚æ•°æµ‹è¯•**: éªŒè¯é…ç½®å‚æ•°çš„æœ‰æ•ˆæ€§

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

### æ–°å¢æ–‡ä»¶
- `src/test/java/com/riceawa/llm/command/MessagePreviewTest.java` - æ¶ˆæ¯é¢„è§ˆåŠŸèƒ½æµ‹è¯•

### ä¿®æ”¹æ–‡ä»¶
1. **src/main/java/com/riceawa/llm/command/LLMChatCommand.java**
   - æ·»åŠ  `showMessagePreview()` æ–¹æ³•
   - ä¿®æ”¹ `handleResume()` æ–¹æ³•ä½¿ç”¨æ–°çš„é¢„è§ˆåŠŸèƒ½
   - ä¿®æ”¹ `handleResumeById()` æ–¹æ³•æ·»åŠ é¢„è§ˆåŠŸèƒ½

2. **src/main/java/com/riceawa/llm/config/ConfigDefaults.java**
   - æ·»åŠ æ¶ˆæ¯é¢„è§ˆç›¸å…³çš„é»˜è®¤é…ç½®å¸¸é‡

3. **src/main/java/com/riceawa/llm/config/LLMChatConfig.java**
   - æ·»åŠ æ¶ˆæ¯é¢„è§ˆé…ç½®å­—æ®µ
   - æ·»åŠ ç›¸åº”çš„getterå’Œsetteræ–¹æ³•
   - åŒ…å«å‚æ•°éªŒè¯å’ŒèŒƒå›´é™åˆ¶

## é…ç½®é€‰é¡¹

ç”¨æˆ·å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

```json
{
  "messagePreviewCount": 5,        // é¢„è§ˆæ¶ˆæ¯æ•°é‡ (1-10)
  "messagePreviewMaxLength": 150   // æ¶ˆæ¯æœ€å¤§æ˜¾ç¤ºé•¿åº¦ (50-500)
}
```

## æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼Œresumeå‘½ä»¤çš„ç”¨æˆ·ä½“éªŒå¾—åˆ°äº†æ˜¾è‘—æå‡ï¼š

1. **ä¸€è‡´æ€§**: ä¸¤ä¸ªresumeå‘½ä»¤ç°åœ¨éƒ½æœ‰ç›¸åŒçš„é¢„è§ˆåŠŸèƒ½
2. **å¯è¯»æ€§**: æ”¹è¿›çš„æ ¼å¼å’Œé¢œè‰²ä½¿æ¶ˆæ¯æ›´å®¹æ˜“é˜…è¯»
3. **ä¿¡æ¯é‡**: æ˜¾ç¤ºæ›´å¤šæœ‰ç”¨ä¿¡æ¯ï¼ˆåºå·ã€è§’è‰²ã€ä¼šè¯ä¿¡æ¯ï¼‰
4. **å¯é…ç½®æ€§**: ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´é¢„è§ˆå‚æ•°
5. **æ™ºèƒ½åŒ–**: æ›´å¥½çš„æˆªæ–­é€»è¾‘ä¿æŒæ¶ˆæ¯å®Œæ•´æ€§

è¿™äº›æ”¹è¿›è®©ç”¨æˆ·åœ¨æ¢å¤å†å²å¯¹è¯æ—¶èƒ½å¤Ÿæ›´å¿«é€Ÿåœ°äº†è§£å¯¹è¯å†…å®¹ï¼Œæå‡äº†æ•´ä½“çš„ä½¿ç”¨ä½“éªŒã€‚
